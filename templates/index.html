<style>
 #my_camera{
     width: 320px;
     height: 240px;
     border: 1px solid black;
}
</style>

<div id="my_camera"></div>
<input type=button value="Take Snapshot" onClick="take_snapshot()">
 
<div id="results" ></div>
 
<!-- Webcam.min.js -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.26/webcam.min.js"></script>

<script language="JavaScript">
    Webcam.set({
        width: 320,
        height: 240,
        image_format: 'jpeg',
        jpeg_quality: 90
    });
    Webcam.attach('#webcam');

    function getHTMLTemplate(bodyFormData) {
      $("#boton").prop('disabled', true);
      $("#loading").show();

      return axios.post( '/upload',
            bodyFormData,
            {
              headers: {
                  'Content-Type': 'multipart/form-data'
              }
            }
          ).then(response => {
            this.response = response.data
           
            return this.response
          })
    };


    function take_snapshot() {
			// take snapshot and get image data
			Webcam.snap( function(data_uri) {
				// display results in page
          var file =  data_uri;
          var bodyFormData = new FormData();
          bodyFormData.append('image', file);

          getHTMLTemplate(bodyFormData)
            .then(data => {
              var text = ""
              if(data.faceMaskDetected){
                text = text.concat("<div class=\"alert alert-success\" style=\"margin-top:10px;\"><strong>¡Genial!</strong> Estás usando una mascarilla.</div>");
                if(data.image_to_show){
                  text = text.concat("<div><img src=\"")
                  text = text.concat(data.image_to_show)
                  text = text.concat("\"></div>")
                  
                }
              }
              else{
                if(data.faceDetected){
                  text = text.concat("<div class=\"alert alert-danger\" style=\"margin-top:10px;\"><strong>¡Cuidado!</strong> No estás usando una mascarilla.</div>");
                  if(data.image_to_show){
                    text = text.concat("<div><img src=\"")
                    text = text.concat(data.image_to_show)
                    text = text.concat("\"></div>")
                  
                  }
                }
                else{
                  text = text.concat("<div class=\"alert alert-danger\" style=\"margin-top:10px;\">No se ha detectado un rostro humano en la foto. Intenta con otra imagen.</div>");
                }
              }
              
              document.getElementById("content").innerHTML = text;
              $("#loading").hide();
              $("#boton").prop('disabled', false);
            });


		});
  } 
  </script>
